@model IEnumerable<Crud1.Models.ContatoModel>

@{
    ViewBag.Title = "Contato";
}

<div class="jumbotron jumbotron-fluid text-center">
    <h1>Contato</h1>
    <p>Cadastro simples de contatos.</p>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="well" id="divConsultaContato">
            <h5>Filtro</h5>
            <form id="frmConsultaContato">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <input type="text" id="nome" name="nome" class="form-control" placeholder="Nome do Contato">
                    </div>

                    <div class="form-group col-md-6">
                        <input type="email" id="email" name="email" class="form-control" placeholder="Email do Contato">
                    </div>
                </div>
                <button id="btnConsultar" name="btnConsultar" type="button" class="btn btn-primary"> Consultar</button>
                <button id="btnAdicionar" name="btnAdicionar" type="button" class="btn btn-success" onclick="location.href='@Url.Action("AdicionaContato", "Contato")'"> Adicionar</button>
            </form>
        </div>
    </div><br /><br /><br /><br />
    <div class="row" style="display:block">
        <div class="col-lg-12">
            <div>
                <table class="table table-responsive-md table-sm table-striped mb-0" id="datatable-contatos">
                    <thead>
                        <tr>
                            <th align="left">@Html.DisplayNameFor(model => model.Nome)</th>
                            <th align="left">@Html.DisplayNameFor(model => model.Email)</th>
                            <th>&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@Html.DisplayFor(modelItem => item.Nome)</td>
                                <td>@Html.DisplayFor(modelItem => item.Email)</td>
                                <td align="right">
                                    <a href='@Url.Action("AtualizaContato", "Contato", new { IdContato = item.IdContato })' class="btn btn-success">Editar</a>
                                    <a href='#' value="@item.IdContato" class="btn btn-danger apagar">Apagar</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


@section Scripts
{
    <script type="text/javascript">

        $(document).ready(function () {

			//Deixei esse exemplo de chamada de Action em ajax
			//para vc ver que da pra acessar a Controller de outra maneira
			//que não esses Url Action etc
			
            $('.apagar').click(function () {

                //Evit post do form
                event.preventDefault();
                
                //Deleta Contato
                $.ajax({
                    url: 'Contato/DeletaContato',
                    method: 'DELETE',
                    data: JSON.stringify({ idContato: $(this).attr('value') }),
                    contentType: "application/json",
                    beforeSend: function () {
                        //Inicia gif ou loading de página
                    },
                    success: function (response) {
                        //Sucesso
                        
                        //Recarrega página para atualizar o grid
                        location.reload();
                    },
                    timeout: 30000, // 30 segundos
                    error: function (req, status, err) {
                        //Notifica erro
                        
                    },
                    complete: function () {
                        //Finaliza gif ou loading de página
                    }
                });

            });

            $('#datatable-contatos').dataTable();
        });

    </script>
}
